!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){c.serverLookupBaseUri="52.36.101.229:9090/core-lookup/api"},{}],2:[function(a,b,c){function d(a){this.message=a}function e(a,b){d.call(this,a),this.status=b}var f=a("./utils");f.inherits(e,d),b.exports={JLoopException:d,ServerException:e}},{"./utils":7}],3:[function(a,b,c){window.jloop=a("./jloop")},{"./jloop":4}],4:[function(a,b,c){var d=a("./config"),e=a("./model"),f=a("./session"),g=(a("./utils"),a("./exceptions")),h=function(a,b){function c(a){var b=f.get("transcript",f.Transcript);b.addEvent(a)}function h(){if(b.initialised===!1)throw new g.JLoopException("jLoopChat not initialised")}function i(a){l&&l(a)}function j(a){m&&m(a)}function k(a){var b=JSON.parse(a.data);if(console.log(b),c(b),"AgentMessage"==b.eventType)i(b);else{if("AgentStatusChange"!=b.eventType)throw new g.JLoopException("Unknown event type '"+eventType+"'");j(b)}}var l=null,m=null;b=b||{},b.initialised=!1,b.websocket=null,b.endpoint=null;var n={};return n.customerId=a.customerId,n.visitorId=null,n.getTranscript=function(){return f.get("transcript",f.Transcript)},n.setOnAgentMessage=function(a){l=a},n.setOnAgentStatusChange=function(a){m=a},n.initialise=function(a,c){n.visitorId=f.get("visitorId");var g=new XMLHttpRequest;g.open("GET","http://"+d.serverLookupBaseUri+"/endpoint?cid="+n.customerId,!0),g.onreadystatechange=function(){if(4==g.readyState)if(200==g.status){b.endpoint=new e.ServerEndpoint(JSON.parse(g.responseText));var d=b.endpoint.url.replace(/^.*?:\/\//g,"");b.websocket=new WebSocket("ws://"+d+"/api/customer/"+n.customerId+"/socket/"+n.visitorId),b.websocket.onmessage=k,b.initialised=!0,a()}else c&&c()},g.send()},n.fetchAgents=function(a,c){h();var d=new XMLHttpRequest;d.open("GET",b.endpoint.url+"/api/customer/"+n.customerId+"/agent",!0),d.onreadystatechange=function(){4==d.readyState&&(200==d.status?a(new e.AgentList(JSON.parse(d.responseText))):c(d.status))},d.send()},n.sendMessage=function(a){return h(),c(a),console.log("Sending..."),console.log(a),b.websocket.send(JSON.stringify(a)),a},n.openConnection=function(a,d){h();var f=new e.VisitorStatusChange({visitorId:n.visitorId,visitorName:a,customerId:n.customerId,agentId:d,status:"online"});return c(f),console.log("Sending..."),console.log(f),b.websocket.send(JSON.stringify(f)),f},n.closeConnection=function(a,d){h();var f=new e.VisitorStatusChange({visitorId:n.visitorId,visitorName:a,customerId:n.customerId,agentId:d,status:"offline"});return c(f),console.log("Sending..."),console.log(f),b.websocket.send(JSON.stringify(f)),f},n};b.exports={jLoopChat:h,model:e,session:f,error:g}},{"./config":1,"./exceptions":2,"./model":5,"./session":6,"./utils":7}],5:[function(a,b,c){function d(a){o.call(this,"VisitorMessage"),this.customerId=a.customerId,this.agentId=a.agentId,this.visitorId=a.visitorId,this.visitorName=a.visitorName,this.message=a.message,this.timestamp=a.timestamp||(new Date).getTime()}function e(a){o.call(this,"AgentMessage"),this.customerId=a.customerId,this.agentId=a.agentId,this.visitorId=a.visitorId,this.visitorName=a.visitorName,this.message=a.message,this.timestamp=a.timestamp||(new Date).getTime()}function f(a){o.call(this,"VisitorStatusChange"),this.visitorId=a.visitorId,this.visitorName=a.visitorName,this.customerId=a.customerId,this.agentId=a.agentId,this.status=a.status,this.timestamp=a.timestamp||(new Date).getTime()}function g(a){o.call(this,"AgentStatusChange"),this.agentId=a.agentId,this.status=a.status,this.timestamp=a.timestamp||(new Date).getTime()}function h(a){this.agentId=a.agentId,this.status=a.status,this.timestamp=a.timestamp||(new Date).getTime()}function i(a){this.agentId=a.agentId,this.customerId=a.customerId,this.displayName=a.displayName,this.welcomeMessage=a.welcomeMessage,this.status=new h(a.status)}function j(a){this.agents=a.agents.map(function(a){return new i(a)})||[]}function k(a){this.nodeId=a.nodeId,this.url=a.url}function l(a){switch(a.eventType){case"VisitorMessage":return new d(a);case"AgentMessage":return new e(a);case"VisitorStatusChange":return new f(a);case"AgentStatusChange":return new g(a);default:throw new m.JLoopException("No such model type")}}var m=a("./exceptions"),n=a("./utils"),o=function(a){this.eventType=a};n.inherits(d,o),n.inherits(e,o),n.inherits(f,o),n.inherits(g,o),b.exports={Event:o,VisitorMessage:d,AgentMessage:e,VisitorStatusChange:f,AgentStatusChange:g,Agent:i,AgentStatus:h,AgentList:j,ServerEndpoint:k,fromPojo:l}},{"./exceptions":2,"./utils":7}],6:[function(a,b,c){function d(a){this.value=a}function e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}function f(a){return t+a}function g(){for(var a=0;a<localStorage.length;++a){var b=localStorage.key(a);b.startsWith(t)&&(localStorage.removeItem(b),--a)}}function h(a,b){var c=localStorage.getItem(f(a));if(null===c)return null;var d=JSON.parse(c).value;return null!=b?new b(d):d}function i(a,b){localStorage.setItem(f(a),JSON.stringify(new d(b)))}function j(a){localStorage.removeItem(f(a))}function k(){g(),i("visitorId",e()),i("visitorName",""),i("transcript",new l),i("_expirationDate",(new Date).getTime()+1e3*u)}function l(a){if(a=a||{},this.events=[],this._key=a.key||"transcript",null!=a.events)for(var b=0;b<a.events.length;++b)this.events.push(s.fromPojo(a.events[b]))}function m(a){o()&&k(),j(a)}function n(){k()}function o(){var a=localStorage.getItem(f("_expirationDate"));return null===a||a<(new Date).getTime()}function p(a,b){return o()&&k(),h(a,b)}function q(a,b){o()&&k(),i(a,b)}function r(a){u=a,i("_expirationDate",(new Date).getTime()+1e3*u)}var s=a("./model");const t="jl_";var u=86400;l.prototype.addEvent=function(a){this.events.push(a),q(this._key,this)},l.prototype.clear=function(){this.events=[],q(this._key,this)},l.prototype.isEmpty=function(){return 0===this.events.length},b.exports={Transcript:l,setLifetime:r,hasExpired:o,remove:m,get:p,put:q,clear:n}},{"./model":5}],7:[function(a,b,c){function d(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a}function e(a,b){var c=Array.prototype.slice.call(arguments);return function(){return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))}}function f(a){var b=[];for(key in a)a.hasOwnProperty(key)&&b.push({key:key,value:a[key]});return b}b.exports={inherits:d,bind:e,dictToArray:f}},{}]},{},[1,2,3,4,5,6,7]);