!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){c.serverLookupBaseUri="52.43.50.221:9090/core-lookup/api"},{}],2:[function(a,b,c){function d(a){this.message=a}function e(a,b){d.call(this,a),this.status=b}var f=a("./utils");f.inherits(e,d),b.exports={JLoopException:d,ServerException:e}},{"./utils":8}],3:[function(a,b,c){window.jloop=a("./jloop")},{"./jloop":4}],4:[function(a,b,c){var d=a("./config"),e=a("./model"),f=a("./session"),g=(a("./utils"),a("./exceptions")),h=a("./syncedTranscript"),i=function(a,b){function c(){if(b.initialised===!1)throw new g.JLoopException("jLoopChat not initialised")}function i(){null!==b.websocket&&b.websocket.close();var a=b.endpoint.url.replace(/^.*?:\/\//g,"");b.websocket=new WebSocket("ws://"+a+"/api/customer/"+o.customerId+"/socket/"+o.session.getId()),b.websocket.onmessage=l}function j(a){m&&m(a)}function k(a){n&&n(a)}function l(a){var b=JSON.parse(a.data);if(console.log(b),o.transcript.addEvent(b),"AgentMessage"==b.eventType)j(b);else{if("AgentStatusChange"!=b.eventType)throw new g.JLoopException("Unknown event type '"+eventType+"'");k(b)}}var m=null,n=null;b=b||{},b.initialised=!1,b.websocket=null,b.endpoint=null;var o={};return o.customerId=a.customerId,o.session=f.session(a.uniquePrefix||"jl"),o.transcript=h(o.session),o.setOnAgentMessage=function(a){m=a},o.setOnAgentStatusChange=function(a){n=a},o.initialise=function(a,c){var f=new XMLHttpRequest;f.open("GET","http://"+d.serverLookupBaseUri+"/endpoint?cid="+o.customerId,!0),f.onreadystatechange=function(){4==f.readyState&&(200==f.status?(b.endpoint=new e.ServerEndpoint(JSON.parse(f.responseText)),i(),b.initialised=!0,a()):c&&c())},f.send()},o.fetchAgents=function(a,d){c();var f=new XMLHttpRequest;f.open("GET",b.endpoint.url+"/api/customer/"+o.customerId+"/agent",!0),f.onreadystatechange=function(){4==f.readyState&&(200==f.status?a(new e.AgentList(JSON.parse(f.responseText))):d(f.status))},f.send()},o.sendMessage=function(a){return c(),o.transcript.addEvent(a),console.log("Sending..."),console.log(a),b.websocket.send(JSON.stringify(a)),a},o.openConnection=function(a,d){c();var f=new e.VisitorStatusChange({visitorId:o.session.getId(),visitorName:a,customerId:o.customerId,agentId:d,status:"online"});return o.transcript.addEvent(f),console.log("Sending..."),console.log(f),b.websocket.send(JSON.stringify(f)),f},o.closeConnection=function(a,d){c();var f=new e.VisitorStatusChange({visitorId:o.session.getId(),visitorName:a,customerId:o.customerId,agentId:d,status:"offline"});return o.transcript.addEvent(f),console.log("Sending..."),console.log(f),b.websocket.send(JSON.stringify(f)),f},o.reset=function(a,b){o.closeConnection(a,b),o.session.clear(),o.transcript.clear(),i()},o};b.exports={jLoopChat:i,model:e,error:g}},{"./config":1,"./exceptions":2,"./model":5,"./session":6,"./syncedTranscript":7,"./utils":8}],5:[function(a,b,c){function d(a){p.call(this,"VisitorMessage"),this.customerId=a.customerId,this.agentId=a.agentId,this.visitorId=a.visitorId,this.visitorName=a.visitorName,this.message=a.message,this.timestamp=a.timestamp||(new Date).getTime()}function e(a){p.call(this,"AgentMessage"),this.customerId=a.customerId,this.agentId=a.agentId,this.visitorId=a.visitorId,this.visitorName=a.visitorName,this.message=a.message,this.timestamp=a.timestamp||(new Date).getTime()}function f(a){p.call(this,"VisitorStatusChange"),this.visitorId=a.visitorId,this.visitorName=a.visitorName,this.customerId=a.customerId,this.agentId=a.agentId,this.status=a.status,this.timestamp=a.timestamp||(new Date).getTime()}function g(a){p.call(this,"AgentStatusChange"),this.agentId=a.agentId,this.status=a.status,this.timestamp=a.timestamp||(new Date).getTime()}function h(a){this.agentId=a.agentId,this.status=a.status,this.timestamp=a.timestamp||(new Date).getTime()}function i(a){this.agentId=a.agentId,this.customerId=a.customerId,this.displayName=a.displayName,this.welcomeMessage=a.welcomeMessage,this.status=new h(a.status)}function j(a){this.agents=a.agents.map(function(a){return new i(a)})||[]}function k(a){this.nodeId=a.nodeId,this.url=a.url}function l(a){if(a=a||{},this.events=[],a.events)for(var b=0;b<a.events.length;++b)this.events.push(m(a.events[b]))}function m(a){switch(a.eventType){case"VisitorMessage":return new d(a);case"AgentMessage":return new e(a);case"VisitorStatusChange":return new f(a);case"AgentStatusChange":return new g(a);default:throw new n.JLoopException("No such model type")}}var n=a("./exceptions"),o=a("./utils"),p=function(a){this.eventType=a};o.inherits(d,p),o.inherits(e,p),o.inherits(f,p),o.inherits(g,p),l.prototype.addEvent=function(a){this.events.push(a)},l.prototype.clear=function(){this.events=[]},l.prototype.isEmpty=function(){return 0===this.events.length},b.exports={Event:p,VisitorMessage:d,AgentMessage:e,VisitorStatusChange:f,AgentStatusChange:g,Agent:i,AgentStatus:h,AgentList:j,ServerEndpoint:k,Transcript:l,fromPojo:m}},{"./exceptions":2,"./utils":8}],6:[function(a,b,c){function d(a){function b(a){f()&&e(),r=a,k("_expirationDate",(new Date).getTime()+1e3*r)}function c(a,b){f()&&e(),k(a,b)}function d(a){f()&&e(),m(a)}function e(){for(var a=0;a<localStorage.length;++a){var b=localStorage.key(a);b&&0===b.lastIndexOf(p,0)&&(localStorage.removeItem(b),--a)}n(),k("_expirationDate",(new Date).getTime()+1e3*r)}function f(){var a=l("_expirationDate");return null===a||a<(new Date).getTime()}function g(a,b){return f()&&e(),l(a,b)}function h(){return f()&&e(),q}function i(a){this.value=a}function j(a){return p+a}function k(a,b){localStorage.setItem(j(a),JSON.stringify(new i(b)))}function l(a,b){var c=localStorage.getItem(j(a));if(null===c)return null;var d=JSON.parse(c);return null!=b?new b(d.value):d.value}function m(a){localStorage.removeItem(j(a))}function n(){q=o(),k("sessionId",q)}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}var p=a||"jl",q=l("sessionId"),r=86400;return null===q&&e(),f()&&e(),{setLifetime:b,put:c,remove:d,clear:e,hasExpired:f,get:g,getId:h}}b.exports={session:d}},{}],7:[function(a,b,c){function d(a){function b(a){h.addEvent(a),g.put("transcript",h)}function c(){h.clear(),g.put("transcript",h)}function d(){return h.isEmpty()}function f(){return h.events}var g=a,h=g.get("transcript",e.Transcript)||new e.Transcript;return{addEvent:b,clear:c,isEmpty:d,getEvents:f}}var e=a("./model");b.exports=d},{"./model":5}],8:[function(a,b,c){function d(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a}function e(a,b){var c=Array.prototype.slice.call(arguments);return function(){return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))}}function f(a){var b=[];for(key in a)a.hasOwnProperty(key)&&b.push({key:key,value:a[key]});return b}b.exports={inherits:d,bind:e,dictToArray:f}},{}]},{},[1,2,3,4,5,6,7,8]);