!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){c.serverLookupBaseUri="52.43.50.221:9090/core-lookup/api"},{}],2:[function(a,b,c){function d(a){this.message=a}function e(a,b){d.call(this,a),this.status=b}var f=a("./utils");f.inherits(e,d),b.exports={JLoopException:d,ServerException:e}},{"./utils":8}],3:[function(a,b,c){window.jloop=a("./jloop")},{"./jloop":4}],4:[function(a,b,c){var d=a("./config"),e=a("./model"),f=a("./session"),g=a("./utils"),h=a("./exceptions"),i=a("./syncedTranscript"),j=function(a,b){function c(){if(b.initialised===!1)throw new h.JLoopException("jLoopChat not initialised")}function j(a){m&&m(a)}function k(a){n&&n(a)}function l(a){var b=JSON.parse(a.data);if(console.log(b),o.transcript.addEvent(b),"AgentMessage"==b.eventType)j(b);else{if("AgentStatusChange"!=b.eventType)throw new h.JLoopException("Unknown event type '"+eventType+"'");k(b)}}var m=null,n=null;b=b||{},b.initialised=!1,b.websocket=null,b.endpoint=null;var o={};return o.customerId=a.customerId,o.visitorId=g.generateUuid(),o.session=f.session(a.uniquePrefix||"jl"),o.transcript=i(o.session),o.setOnAgentMessage=function(a){m=a},o.setOnAgentStatusChange=function(a){n=a},o.initialise=function(a,c){o.visitorId=o.session.get("visitorId");var f=new XMLHttpRequest;f.open("GET","http://"+d.serverLookupBaseUri+"/endpoint?cid="+o.customerId,!0),f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status){b.endpoint=new e.ServerEndpoint(JSON.parse(f.responseText));var d=b.endpoint.url.replace(/^.*?:\/\//g,"");b.websocket=new WebSocket("ws://"+d+"/api/customer/"+o.customerId+"/socket/"+o.visitorId),b.websocket.onmessage=l,b.initialised=!0,a()}else c&&c()},f.send()},o.fetchAgents=function(a,d){c();var f=new XMLHttpRequest;f.open("GET",b.endpoint.url+"/api/customer/"+o.customerId+"/agent",!0),f.onreadystatechange=function(){4==f.readyState&&(200==f.status?a(new e.AgentList(JSON.parse(f.responseText))):d(f.status))},f.send()},o.sendMessage=function(a){return c(),o.transcript.addEvent(a),console.log("Sending..."),console.log(a),b.websocket.send(JSON.stringify(a)),a},o.openConnection=function(a,d){c();var f=new e.VisitorStatusChange({visitorId:o.visitorId,visitorName:a,customerId:o.customerId,agentId:d,status:"online"});return o.transcript.addEvent(f),console.log("Sending..."),console.log(f),b.websocket.send(JSON.stringify(f)),f},o.closeConnection=function(a,d){c();var f=new e.VisitorStatusChange({visitorId:o.visitorId,visitorName:a,customerId:o.customerId,agentId:d,status:"offline"});return o.transcript.addEvent(f),console.log("Sending..."),console.log(f),b.websocket.send(JSON.stringify(f)),f},o};b.exports={jLoopChat:j,model:e,error:h}},{"./config":1,"./exceptions":2,"./model":5,"./session":6,"./syncedTranscript":7,"./utils":8}],5:[function(a,b,c){function d(a){p.call(this,"VisitorMessage"),this.customerId=a.customerId,this.agentId=a.agentId,this.visitorId=a.visitorId,this.visitorName=a.visitorName,this.message=a.message,this.timestamp=a.timestamp||(new Date).getTime()}function e(a){p.call(this,"AgentMessage"),this.customerId=a.customerId,this.agentId=a.agentId,this.visitorId=a.visitorId,this.visitorName=a.visitorName,this.message=a.message,this.timestamp=a.timestamp||(new Date).getTime()}function f(a){p.call(this,"VisitorStatusChange"),this.visitorId=a.visitorId,this.visitorName=a.visitorName,this.customerId=a.customerId,this.agentId=a.agentId,this.status=a.status,this.timestamp=a.timestamp||(new Date).getTime()}function g(a){p.call(this,"AgentStatusChange"),this.agentId=a.agentId,this.status=a.status,this.timestamp=a.timestamp||(new Date).getTime()}function h(a){this.agentId=a.agentId,this.status=a.status,this.timestamp=a.timestamp||(new Date).getTime()}function i(a){this.agentId=a.agentId,this.customerId=a.customerId,this.displayName=a.displayName,this.welcomeMessage=a.welcomeMessage,this.status=new h(a.status)}function j(a){this.agents=a.agents.map(function(a){return new i(a)})||[]}function k(a){this.nodeId=a.nodeId,this.url=a.url}function l(a){if(a=a||{},this.events=[],a.events)for(var b=0;b<a.events.length;++b)this.events.push(m(a.events[b]))}function m(a){switch(a.eventType){case"VisitorMessage":return new d(a);case"AgentMessage":return new e(a);case"VisitorStatusChange":return new f(a);case"AgentStatusChange":return new g(a);default:throw new n.JLoopException("No such model type")}}var n=a("./exceptions"),o=a("./utils"),p=function(a){this.eventType=a};o.inherits(d,p),o.inherits(e,p),o.inherits(f,p),o.inherits(g,p),l.prototype.addEvent=function(a){this.events.push(a)},l.prototype.clear=function(){this.events=[]},l.prototype.isEmpty=function(){return 0===this.events.length},b.exports={Event:p,VisitorMessage:d,AgentMessage:e,VisitorStatusChange:f,AgentStatusChange:g,Agent:i,AgentStatus:h,AgentList:j,ServerEndpoint:k,Transcript:l,fromPojo:m}},{"./exceptions":2,"./utils":8}],6:[function(a,b,c){function d(a){function b(a){m=a,j("_expirationDate",(new Date).getTime()+1e3*m)}function c(a,b){f()&&e(),j(a,b)}function d(a){f()&&e(),l(a)}function e(){for(var a=0;a<localStorage.length;++a){var b=localStorage.key(a);b&&0===b.lastIndexOf(n,0)&&(localStorage.removeItem(b),--a)}j("_expirationDate",(new Date).getTime()+1e3*m)}function f(){var a=k("_expirationDate");return null===a||a<(new Date).getTime()}function g(a,b){return f()&&e(),k(a,b)}function h(a){this.value=a}function i(a){return n+a}function j(a,b){localStorage.setItem(i(a),JSON.stringify(new h(b)))}function k(a,b){var c=localStorage.getItem(i(a));if(null===c)return null;var d=JSON.parse(c);return null!=b?new b(d.value):d.value}function l(a){localStorage.removeItem(i(a))}var m=86400,n=a||"jl";return{setLifetime:b,put:c,remove:d,clear:e,hasExpired:f,get:g}}b.exports={session:d}},{}],7:[function(a,b,c){function d(a){function b(a){h.addEvent(a),g.put("transcript",h)}function c(){h.clear(),g.put(h)}function d(){return h.isEmpty()}function f(){return h.events}var g=a,h=g.get("transcript",e.Transcript)||new e.Transcript;return{addEvent:b,clear:c,isEmpty:d,getEvents:f}}var e=a("./model");b.exports=d},{"./model":5}],8:[function(a,b,c){function d(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a}function e(a,b){var c=Array.prototype.slice.call(arguments);return function(){return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))}}function f(a){var b=[];for(key in a)a.hasOwnProperty(key)&&b.push({key:key,value:a[key]});return b}function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}b.exports={inherits:d,bind:e,dictToArray:f,generateUuid:g}},{}],9:[function(a,b,c){b.exports=function(){return{basePath:"",frameworks:["browserify","jasmine"],files:[],exclude:[],preprocessors:{"unit/*.js":["browserify"]},reporters:["spec"],port:9876,colors:!0,autoWatch:!0,browsers:["PhantomJS"],singleRun:!1}}},{}],10:[function(a,b,c){var d=a("./karma-shared.conf.js")();b.exports=function(a){d.files=d.files.concat(["unit/**.js"]),d.logLevel=a.LOG_INFO,a.set(d)}},{"./karma-shared.conf.js":9}],11:[function(a,b,c){},{}],12:[function(a,b,c){var d=d||{};d.mockWindow=function(){var a=0,b=0,c=jQuery(window);this.scrollLeft=function(b){return"undefined"==typeof b?a:void(a=b)},this.scrollTop=function(a){return"undefined"==typeof a?b:void(b=a)},this.get=function(a){return c.get(a)},this.on=function(a,b){c.on(a,b)},this.triggerHandler=function(a){c.triggerHandler(a)}}},{}],13:[function(a,b,c){"use strict";var d=a("../../js/session"),e=a("../../js/model");describe("session",function(){jasmine.clock().install();var a=new Date(2e3,1,1);beforeEach(function(){jasmine.clock().mockDate(a)}),it("should clear values",function(){var a=d.session();a.put("foo","bar"),a.clear(),expect(a.get("foo")).toBe(null)}),it("should store values",function(){var a=d.session();a.put("foo","bar"),expect(a.get("foo")).toBe("bar")}),it("should store complex objects",function(){function a(a){a=a||{},this.a=a.a||0,this.b=a.b||"",this.c={d:a.c.d||0}}var b=d.session();a.prototype.foo=function(){return this.a*this.c.d};var c=new a({a:2,b:"three",c:{d:4.1}});b.put("obj",c);var e=b.get("obj",a);expect(e.a).toBe(2),expect(e.b).toBe("three"),expect(e.c.d).toBe(4.1),expect(e.foo()).toBe(8.2)}),it("should remove values",function(){var a=d.session();a.put("foo","bar"),a.remove("foo"),expect(a.get("foo")).toBe(null)}),it("Should expire",function(){var a=d.session();a.setLifetime(4),a.put("foo","bar"),jasmine.clock().tick(4e3),expect(a.get("foo")).toBe("bar"),jasmine.clock().tick(1),expect(a.get("foo")).toBe(null)}),it("should contain same data for instances with the same prefix",function(){var a=d.session("s1"),b=d.session("s2");a.put("foo",123),b.put("foo",456),expect(a.get("foo")).toBe(123),expect(b.get("foo")).toBe(456)}),it("should contain different data for instances with different prefixes",function(){var a=d.session("s1"),b=d.session("s1");a.put("foo",123),b.put("foo",456),expect(a.get("foo")).toBe(456),expect(b.get("foo")).toBe(456)}),it("should store and restore a Transcript instance",function(){var a=d.session(),b=new e.Transcript,c=new e.VisitorMessage({customerId:"abc",agentId:"def",visitorId:"ace",message:"Hello"});b.addEvent(c),a.put("transcript",b);var f=a.get("transcript",e.Transcript),g=f.events[0];expect(g.customerId).toBe(c.customerId),expect(g.agentId).toBe(c.agentId),expect(g.visitorId).toBe(c.visitorId),expect(g.message).toBe(c.message)})})},{"../../js/model":5,"../../js/session":6}],14:[function(a,b,c){"use strict";var d=a("../../js/model"),e=a("../../js/session"),f=a("../../js/syncedTranscript");describe("syncedTranscript",function(){it("should log events",function(){var a=e.session(),b=f(a),c=new d.VisitorMessage({customerId:"abc",agentId:"def",visitorId:"ace",message:"Hello"});b.addEvent(c);var g=b.getEvents()[0];expect(g.customerId).toBe(c.customerId),expect(g.agentId).toBe(c.agentId),expect(g.visitorId).toBe(c.visitorId),expect(g.message).toBe(c.message)}),it("should extract transcript from session",function(){var a=e.session(),b=f(a),c=new d.VisitorMessage({customerId:"abc",agentId:"def",visitorId:"ace",message:"Hello"});b.addEvent(c);var g=f(a),h=g.getEvents()[0];expect(h.customerId).toBe(c.customerId),expect(h.agentId).toBe(c.agentId),expect(h.visitorId).toBe(c.visitorId),expect(h.message).toBe(c.message)})})},{"../../js/model":5,"../../js/session":6,"../../js/syncedTranscript":7}]},{},[1,2,3,4,5,6,7,8,9,10,11,12,13,14]);